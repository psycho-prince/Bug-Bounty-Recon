name: OpenAI Recon – Parallel Zero-Credit Bug Hunt – 2026 Edition
on:
  workflow_dispatch:

jobs:
  sora-social-recon:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create evidence directory
        run: mkdir -p evidence/sora

      - name: Fetch Sora Assets & JS Chunks
        run: |
          # Targeting sora.com and the newer sora.openai.com subdomain
          for domain in "sora.com" "sora.openai.com"; do
            curl -s -A "Mozilla/5.0 ReconBot" "https://$domain" \
              | grep -oE '(/static/chunks/[^"]+\.js|/static/js/[^"]+\.js|_next/static/chunks/[^"]+)' \
              | sort -u >> evidence/sora/sora_js_chunks.txt || true
          done

      - name: Deep Scan Sora for IDOR Logic
        run: |
          # 2026 Specific: Searching for "Cameo" and "Remix" authorization logic
          # These are P1 targets because they involve user likeness.
          while read -r chunk; do
            full_url="https://sora.com${chunk}"
            curl -s -m 15 -A "Mozilla/5.0 ReconBot" "$full_url" \
              | grep -oE '([a-zA-Z0-9_-]*_id|permission|auth|role|internal|beta|cameo|remix|draft|group|admin)' \
              | grep -iE 'cameo_id|character_id|draft_id|group_id|permission|block|consent|revoke|remix|feed|likeness|dm|private_group' \
              >> evidence/sora/sora_idor_strings.txt || true
          done < evidence/sora/sora_js_chunks.txt
          sort -u evidence/sora/sora_idor_strings.txt > evidence/sora/sora_idor_unique.txt

      - name: Upload Sora artifacts
        uses: actions/upload-artifact@v4
        with:
          name: sora-recon
          path: evidence/sora/

  atlas-browser-recon:
    runs-on: ubuntu-latest
    steps:
      - name: Create evidence directory
        run: mkdir -p evidence/atlas

      - name: Atlas Sandbox Escape Check
        run: |
          # Testing the "Bridge" between ChatGPT and the Atlas OS Agent
          curl -s -A "Mozilla/5.0 ReconBot" https://chatgpt.com/atlas \
            | grep -oE '([a-zA-Z0-9_-]*_bridge|sandbox|filesystem|local|agentic|escape|socket)' \
            > evidence/atlas/atlas_keywords.txt || true
          # Look for hidden API routes for the browser agent
          curl -s https://chatgpt.com/atlas | grep -oE '/backend-api/[a-zA-Z0-9_-]+' >> evidence/atlas/atlas_keywords.txt || true

      - name: Upload Atlas artifacts
        uses: actions/upload-artifact@v4
        with:
          name: atlas-recon
          path: evidence/atlas/

  third-party-leaks-recon:
    runs-on: ubuntu-latest
    steps:
      - name: Create evidence directory
        run: mkdir -p evidence/leaks

      - name: High-Impact Token Search
        run: |
          # Search for specific 2026 codenames: "Strawberry", "Orion", "Sora-Internal"
          queries=("openai sk-proj" "openai internal project" "openai confidential" "openai strawberry" "openai orion")
          for q in "${queries[@]}"; do
            encoded_q=$(echo "$q" | sed 's/ /+/g')
            # Using a mock-search simulation (since GitHub Search API requires a token)
            echo "Searching GitHub for: $q"
            curl -s "https://github.com/search?q=${encoded_q}&type=code" | grep -oE 'sk-proj-[a-zA-Z0-9_-]{20,}' >> evidence/leaks/potential_keys.txt || true
          done

      - name: Upload leaks
        uses: actions/upload-artifact@v4
        with:
          name: third-party-leaks
          path: evidence/leaks/

  unreleased-features-recon:
    runs-on: ubuntu-latest
    steps:
      - name: Create evidence directory
        run: mkdir -p evidence/unreleased

      - name: Scan for Unannounced Products (The "Bonus" Hunt)
        run: |
          # Grepping for future model names to get the "Information Disclosure" bounty
          curl -s https://openai.com/sitemap.xml | grep -oE '[a-zA-Z0-9_-]*gpt-[0-9][a-zA-Z0-9_-]*' >> evidence/unreleased/model_names.txt || true
          curl -s https://openai.com | grep -iE 'gpt-5|gpt-6|o1-pro|strawberry|search-gpt|atlas-browser' >> evidence/unreleased/unreleased_strings.txt || true

      - name: Upload unreleased
        uses: actions/upload-artifact@v4
        with:
          name: unreleased-features
          path: evidence/unreleased/

  summary:
    runs-on: ubuntu-latest
    needs: [sora-social-recon, atlas-browser-recon, third-party-leaks-recon, unreleased-features-recon]
    if: always()
    steps:
      - name: Download all
        uses: actions/download-artifact@v4
      - name: Generate Final Summary
        run: |
          echo "=== 2026 REDEMPTION SUMMARY ==="
          echo "Sora Social IDs: $(wc -l < sora-recon/sora_idor_unique.txt || echo 0)"
          echo "Atlas Sandbox Strings: $(wc -l < atlas-recon/atlas_keywords.txt || echo 0)"
          echo "Leaked Key Patterns: $(wc -l < third-party-leaks/potential_keys.txt || echo 0)"
          echo "Total Potential Findings: $(ls -R | grep .txt | wc -l)"
          
