name: Flowwow-Max-Elite-Bounty
on:
  workflow_dispatch:
    inputs:
      target:
        description: 'Primary Target (flowwow.com)'
        required: true
        default: 'flowwow.com'

jobs:
  exploit-hunt:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Advanced Arsenal
        run: |
          sudo apt-get update && sudo apt-get install -y openvpn python3-requests curl
          go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
          go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          go install -v github.com/projectdiscovery/katana/cmd/katana@latest
          pip install arjun
          sudo mv ~/go/bin/* /usr/local/bin/

      - name: Relentless VPN Connection Loop
        shell: bash
        run: |
          INITIAL_IP=$(curl -s https://ifconfig.me)
          echo "Initial IP: $INITIAL_IP"
          CONNECTED=false
          ATTEMPT=1
          MAX_ATTEMPTS=10

          while [ "$CONNECTED" = false ] && [ $ATTEMPT -le $MAX_ATTEMPTS ]; do
            echo "VPN Connection Attempt #$ATTEMPT..."
            
            # 1. Fetch a fresh VPN config using the Padding-Fixed Python script
            python3 -c "
          import requests, base64, binascii, random
          try:
              r = requests.get('https://www.vpngate.net/api/iphone/', timeout=10)
              servers = [line for line in r.text.split('\n') if not line.startswith('*') and len(line) > 10]
              # Pick a random server from the top 15 for better luck
              data = random.choice(servers[:15]).split(',')
              b64_str = data[-1].strip()
              missing_padding = len(b64_str) % 4
              if missing_padding: b64_str += '=' * (4 - missing_padding)
              with open('auto.ovpn', 'wb') as f: f.write(base64.b64decode(b64_str))
          except Exception as e: exit(1)
          "
            
            # 2. Try to connect in the background
            sudo killall openvpn 2>/dev/null || true
            sudo openvpn --config auto.ovpn --daemon
            sleep 30  # Wait for handshake
            
            # 3. Verify IP change
            CURRENT_IP=$(curl -s --max-time 10 https://ifconfig.me || echo "FAILED")
            
            if [ "$CURRENT_IP" != "FAILED" ] && [ "$CURRENT_IP" != "$INITIAL_IP" ]; then
              echo "✅ VPN Connected Successfully! New IP: $CURRENT_IP"
              CONNECTED=true
            else
              echo "❌ Attempt #$ATTEMPT failed. Retrying with different server..."
              ATTEMPT=$((ATTEMPT+1))
            fi
          done

          if [ "$CONNECTED" = false ]; then
            echo "CRITICAL ERROR: Could not establish VPN after $MAX_ATTEMPTS tries."
            exit 1
          fi

      - name: Scope-Locked Recon
        run: |
          # Define scope based on program rules
          echo "flowwow.com" > scope.txt
          echo "apis.flowwow.com" >> scope.txt
          echo "api2.flowwow.com" >> scope.txt
          echo "api-shop.flowwow.com" >> scope.txt
          echo "clientweb.flowwow.com" >> scope.txt
          subfinder -dL scope.txt -silent > final_scope.txt
          httpx -l final_scope.txt -silent -o live.txt

      - name: "CRITICAL: Logic & IDOR Parameter Mining"
        run: |
          # Deep spidering for hidden endpoints
          katana -list live.txt -jc -kf all -d 3 -o endpoints.txt
          # Filter for high-value targets and find hidden params
          grep -E "api|shop|client" endpoints.txt | head -n 20 > high_priority.txt
          while read -r url; do
            arjun -u "$url" --rate-limit 2 -oJ "params_$(date +%s).json"
          done < high_priority.txt

      - name: "CRITICAL: Vulnerability Scanning"
        run: |
          # Scans for SSRF, RCE, and Critical CVEs
          nuclei -l endpoints.txt -t vulnerabilities/ssrf/ -t cves/ -severity critical,high -rate-limit 5 -o nuclei_results.txt

      - name: Archive Elite Evidence
        uses: actions/upload-artifact@v4
        with:
          name: flowwow-max-results
          path: |
            nuclei_results.txt
            endpoints.txt
            params_*.json
            
