name: Flowwow-Advanced-Logic-Hunt
on:
  workflow_dispatch:
    inputs:
      target:
        description: 'Primary Target (flowwow.com)'
        required: true
        default: 'flowwow.com'

jobs:
  exploit-hunt:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Tools
        run: |
          go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
          go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install -v github.com/projectdiscovery/katana/cmd/katana@latest
          go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          go install -v github.com/lc/gau/v2/cmd/gau@latest
          go install -v github.com/hakluke/hakrawler@latest
          pip install arjun
          sudo mv ~/go/bin/* /usr/local/bin/

      - name: VPN Connection (Requirement)
        uses: "kota65535/github-openvpn-connect-action@v2"
        with:
          config_file: ${{ secrets.OVPN_CONFIG }}

      - name: Deep Recon & JS Mining
        run: |
          # 1. Gather all subdomains and historical URLs
          subfinder -d ${{ github.event.inputs.target }} -silent > subs.txt
          cat subs.txt | gau --threads 5 >> urls.txt
          
          # 2. Extract API endpoints from JavaScript files (Crucial for IDOR/Logic)
          # Flowwow uses many clientweb and api domains; JS often hides the 'real' paths.
          katana -list subs.txt -jc -kf all -d 3 -silent -o spidered_endpoints.txt

      - name: SSRF & OOB Probing
        run: |
          # Testing for SSRF (Critical Priority)
          # Note: Replace 'your-interactsh-domain' with your private OOB server or Burp Collaborator
          nuclei -l spidered_endpoints.txt -t exposures/configs/ -t vulnerabilities/ssrf/ \
                 -var interactsh_url=${{ secrets.OOB_SERVER }} -severity critical,high

      - name: Business Logic & Parameter Fuzzing
        run: |
          # 3. Focus on 'api-shop' and 'clientweb' for IDOR
          grep -E "api|shop|client" spidered_endpoints.txt | head -n 20 > logic_targets.txt
          
          while read -r url; do
            # Arjun finds hidden params like ?admin=true or ?user_id=123
            arjun -u "$url" --rate-limit 2 -oJ "params_$(date +%s).json"
            
            # Fuzzing for IDOR-prone paths (e.g., /api/v1/orders/FUZZ)
            # Flowwow specifically mentioned 'Business Logic' and 'IDOR'
            ffuf -u "$url/FUZZ" -w http://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/api/api-endpoints.txt \
                 -mc 200,401 -rate 3 -o "logic_fuzz_$(date +%s).json"
          done < logic_targets.txt

      - name: Upload Critical Evidence
        uses: actions/upload-artifact@v4
        with:
          name: flowwow-critical-results
          path: |
            nuclei_results.txt
            params_*.json
            logic_fuzz_*.json
            spidered_endpoints.txt
            
