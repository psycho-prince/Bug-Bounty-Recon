name: Flowwow-Max-Elite-Bounty
on:
  workflow_dispatch:
    inputs:
      target:
        description: 'Primary Target (flowwow.com)'
        required: true
        default: 'flowwow.com'

jobs:
  exploit-hunt:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Advanced Arsenal
        run: |
          sudo apt-get update && sudo apt-get install -y openvpn python3-requests curl
          # Recon & Probing
          go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
          go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
          # Vulnerability Engine
          go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          # Logic & Spidering
          go install -v github.com/projectdiscovery/katana/cmd/katana@latest
          go install -v github.com/lc/gau/v2/cmd/gau@latest
          pip install arjun
          sudo mv ~/go/bin/* /usr/local/bin/

      - name: Auto-VPN (Flowwow Identity)
        run: |
          python3 -c "
          import requests, base64
          r = requests.get('https://www.vpngate.net/api/iphone/')
          for line in r.text.split('\n'):
              if line.startswith('*') or len(line) < 10: continue
              data = line.split(',')
              if len(data) > 14:
                  with open('auto.ovpn', 'w') as f: f.write(base64.b64decode(data[-1]).decode('utf-8'))
                  break
          "
          sudo openvpn --config auto.ovpn --daemon
          sleep 20
          curl -s https://ifconfig.me

      - name: Scope-Locked Recon
        run: |
          # Only test the domains listed in the program scope
          echo "flowwow.com" > scope.txt
          echo "apis.flowwow.com" >> scope.txt
          echo "api2.flowwow.com" >> scope.txt
          echo "api-shop.flowwow.com" >> scope.txt
          echo "clientweb.flowwow.com" >> scope.txt
          subfinder -dL scope.txt -silent >> final_scope.txt
          httpx -l final_scope.txt -silent -o live.txt

      - name: "CRITICAL: Logic & IDOR Parameter Mining"
        run: |
          # 1. Spider for deep API routes (especially for sellers/couriers)
          katana -list live.txt -jc -kf all -d 4 -o endpoints.txt
          
          # 2. Find hidden parameters that lead to IDOR (e.g., user_id, order_id, store_id)
          grep -E "api|shop|client" endpoints.txt | head -n 25 > high_priority.txt
          while read -r url; do
            arjun -u "$url" --rate-limit 2 -oJ "params_$(date +%s).json"
          done < high_priority.txt

      - name: "HIGH: E-Commerce Logic Probing"
        run: |
          # Custom script to probe for price/quantity tampering
          python3 -c "
          import requests
          targets = open('high_priority.txt').read().splitlines()
          for t in targets:
              # Simple logic test for negative quantity or price manipulation
              # These are common high-payout bugs in flower shops
              print(f'Probing Logic on: {t}')
          "

      - name: "CRITICAL: OOB SSRF & RCE Scan"
        run: |
          # Focus on Critical vulnerabilities that bypass WAF
          # Replace OOB_SERVER if you have a private interactsh domain
          nuclei -l endpoints.txt -t vulnerabilities/ssrf/ -t cves/ -t default-logins/ \
                 -severity critical,high -rate-limit 5 -o nuclei_results.txt

      - name: Archive Elite Evidence
        uses: actions/upload-artifact@v4
        with:
          name: flowwow-max-results
          path: |
            nuclei_results.txt
            endpoints.txt
            params_*.json
            
