name: OpenAI-Infrastructure-Logic-Hunt
on:
  workflow_dispatch:

jobs:
  exploit-hunt:
    runs-on: ubuntu-latest
    steps:
      - name: Install Arsenal
        run: |
          go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
          go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install -v github.com/projectdiscovery/katana/cmd/katana@latest
          go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          go install -v github.com/lc/gau/v2/cmd/gau@latest
          pip install arjun
          sudo mv ~/go/bin/* /usr/local/bin/

      - name: Recon: Massive Surface & History
        run: |
          echo "openai.com" > scope.txt
          echo "api.openai.com" >> scope.txt
          
          # 1. Passive discovery of every URL ever seen (Historical Mining)
          cat scope.txt | gau --subs --threads 2 > historical_urls.txt
          
          # 2. Live subdomain discovery
          subfinder -dL scope.txt -silent -o subdomains.txt
          httpx -l subdomains.txt -silent -o live_targets.txt

      - name: The Mining Step: API Logic & Codenames
        run: |
          # 1. Deep spidering focusing on APIs and JS bundles
          katana -list live_targets.txt -jc -kf all -d 4 -ratelimit 2 -o all_endpoints.txt
          
          # 2. Extract targets likely to have BOLA/IDOR (UUIDs, IDs in paths)
          grep -E "/v[0-9]/|[a-f0-9]{8}-" all_endpoints.txt > potential_idor_targets.txt
          
          # 3. Search for Unreleased Product Names (Explicit Bounty Category)
          grep -Ei "codename|arrakis|gobi|internal-only|beta-feature" all_endpoints.txt > unreleased_intel.txt

      - name: Automated Vulnerability & Leak Check
        run: |
          # Focus Nuclei on EXPOSURES (keys, configs, azure blobs)
          nuclei -l all_endpoints.txt -t exposures/ -t vulnerabilities/ -severity critical,high -rate-limit 2 -o nuclei_results.txt
          
          # Parameter Fuzzing on top API endpoints to find hidden 'debug' or 'admin' flags
          head -n 10 potential_idor_targets.txt | while read -r url; do
            arjun -u "$url" --rate-limit 1 -oJ "params_$(date +%s).json"
          done

      - name: Upload Bounty Gold
        uses: actions/upload-artifact@v4
        with:
          name: openai-gold-mine
          path: |
            nuclei_results.txt
            unreleased_intel.txt
            potential_idor_targets.txt
            params_*.json
            
