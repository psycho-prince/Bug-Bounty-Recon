name: OpenAI Recon â€“ Deep bj
on:
  workflow_dispatch:

jobs:
  deep-scan:
    runs-on: ubuntu-latest
    steps:
      - name: Create Evidence Dir
        run: mkdir -p evidence/deep_dive

      - name: Enumerate Next.js Build IDs
        run: |
          # Finding the 'Build ID' allows us to find hidden JSON data for every page
          BUILD_ID=$(curl -s https://sora.com/ | grep -oE '"buildId":"[^"]+"' | cut -d'"' -f4)
          echo "Build ID Found: $BUILD_ID"
          echo $BUILD_ID > evidence/deep_dive/build_id.txt

          # Common pages to check for hidden data
          PAGES=("index" "library" "creations" "settings" "profile" "explore")
          for page in "${PAGES[@]}"; do
            URL="https://sora.com/_next/data/${BUILD_ID}/${page}.json"
            echo "Checking: $URL"
            curl -s -o "evidence/deep_dive/${page}_data.json" "$URL" || true
          done

      - name: Extract Hidden IDs & API Endpoints
        run: |
          # Extract anything that looks like a UUID or a secret endpoint from the JSON data
          grep -oE '[a-f0-9-]{36}' evidence/deep_dive/*.json > evidence/deep_dive/found_uuids.txt || true
          grep -oE 'https://[^"]+openai\.com/[^"]+' evidence/deep_dive/*.json > evidence/deep_dive/hidden_api_routes.txt || true

      - name: Grep for "Internal Only" Logic
        run: |
          # Look for flags that indicate features disabled for the public but active in the code
          grep -iE 'isInternal|isAdmin|experimental|feature_flag|can_edit_others' evidence/deep_dive/*.json >> evidence/deep_dive/logic_flags.txt || true

      - name: Upload Deep Dive
        uses: actions/upload-artifact@v4
        with:
          name: deep-dive-results
          path: evidence/deep_dive/
          
