name: Bug Bounty Advanced Recon
on:
  workflow_dispatch:
    inputs:
      target:
        description: 'Target Domain'
        required: true
        default: 'web-zaim.ru'

jobs:
  advanced-scan:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Go & Install Tools
        run: |
          go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
          go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          sudo mv ~/go/bin/* /usr/local/bin/

      - name: Execute Smart Recon
        run: |
          TARGET="${{ github.event.inputs.target }}"
          HEADER="X-BugBounty: 0a526762-8467-4d46-a403-af4e79283f46"
          
          # 1. Passive Subdomain Discovery
          subfinder -d $TARGET -all -silent -o subs.txt
          
          # 2. Live Probing with Tech Detection
          httpx -l subs.txt -H "$HEADER" -silent -td -title -status-code -o live.txt
          
          # 3. Targeted Nuclei Scan (Optimized to prevent cancellation)
          # We limit concurrency to 2 and bulk-size to 1 to keep memory low and stay under 5 req/s
          nuclei -l live.txt \
            -H "$HEADER" \
            -severity critical,high \
            -rate-limit 5 \
            -bulk-size 1 \
            -concurrency 2 \
            -stats \
            -o results.txt

      - name: Upload Results
        uses: actions/upload-artifact@v4
        with:
          name: scan-results-${{ github.event.inputs.target }}
          path: |
            live.txt
            results.txt
            
